name: Sync to Hugging Face Hub

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install Hugging Face Hub
        run: |
          python -m pip install --upgrade pip
          pip install huggingface_hub

      - name: Upload to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python << 'EOF'
          import os
          from huggingface_hub import HfApi
          
          token = os.environ.get("HF_TOKEN")
          if not token:
              raise SystemExit("HF_TOKEN bulunamadı!")
          
          api = HfApi()
          
          print("Hugging Face Space'e yükleme yapılıyor")
          
          try:
              api.upload_folder(
                  repo_id="4F71/instacart-reorder-prediction",
                  repo_type="space",
                  folder_path=".",
                  path_in_repo=".",
                  token=token,
                  ignore_patterns=[
                      ".git/*",
                      ".github/*",
                      ".venv/*",
                      "venv/*",
                      "__pycache__/*",
                      "*.pyc",
                      ".DS_Store",
                      ".ipynb_checkpoints/*",
                      ".gitignore",
                      ".gitattributes",
                      "*.log"
                  ]
              )
              print("yükleme tamamlandı!")
          except Exception as e:
              print(f"Hata: {e}")
              raise
          EOF